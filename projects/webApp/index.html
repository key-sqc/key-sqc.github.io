<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å»ä¸­å¿ƒåŒ–å³æ—¶é€šè®¯</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å»ä¸­å¿ƒåŒ–å³æ—¶é€šè®¯</h1>
            <p>ç‚¹å¯¹ç‚¹åŠ å¯†èŠå¤© Â· æ— éœ€æœåŠ¡å™¨</p>
        </div>
        
        <!-- ä½¿ç”¨è¯´æ˜é¢æ¿ -->
        <div class="instructions-panel" id="instructionsPanel">
            <h3>ğŸ“± ä½¿ç”¨è¯´æ˜</h3>
            <div class="steps">
                <div class="step">
                    <span class="step-number">1</span>
                    <span class="step-text">ä¸€æ–¹ç‚¹å‡»"åˆ›å»ºæˆ¿é—´"ç”ŸæˆäºŒç»´ç </span>
                </div>
                <div class="step">
                    <span class="step-number">2</span>
                    <span class="step-text">å¦ä¸€æ–¹ç‚¹å‡»"åŠ å…¥æˆ¿é—´"æ‰«æäºŒç»´ç </span>
                </div>
                <div class="step">
                    <span class="step-number">3</span>
                    <span class="step-text">è¿æ¥æˆåŠŸåå³å¯å¼€å§‹ç§å¯†èŠå¤©</span>
                </div>
            </div>
            <button id="startBtn" class="start-button">å¼€å§‹ä½¿ç”¨</button>
        </div>
        
        <div class="connection-panel" id="connectionPanel" style="display: none;">
            <div class="connection-status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">ç­‰å¾…è¿æ¥...</span>
            </div>
            
            <!-- è¯¦ç»†çŠ¶æ€ä¿¡æ¯ -->
            <div class="status-details" id="statusDetails">
                <div class="status-item">
                    <span class="status-label">è¿æ¥çŠ¶æ€:</span>
                    <span class="status-value" id="webrtcStatus">æœªè¿æ¥</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æˆ¿é—´å·:</span>
                    <span class="status-value" id="roomCode">-</span>
                </div>
            </div>
            
            <div class="connection-actions">
                <button id="createBtn" class="action-btn primary">åˆ›å»ºæˆ¿é—´</button>
                <button id="connectBtn" class="action-btn secondary">åŠ å…¥æˆ¿é—´</button>
                <button id="disconnectBtn" class="action-btn danger" style="display: none;">æ–­å¼€è¿æ¥</button>
            </div>
            
            <!-- äºŒç»´ç æ˜¾ç¤ºé¢æ¿ -->
            <div class="qr-panel" id="qrPanel" style="display: none;">
                <div class="qr-header">
                    <h4>ğŸ“± æ‰«æäºŒç»´ç åŠ å…¥</h4>
                    <p>è¯·å¯¹æ–¹æ‰«ææ­¤äºŒç»´ç </p>
                </div>
                <div class="qr-code-container">
                    <canvas id="qrCanvas"></canvas>
                </div>
                <div class="manual-code">
                    <p>æˆ–æ‰‹åŠ¨è¾“å…¥ä»£ç ï¼š</p>
                    <div class="code-display" id="manualCodeDisplay"></div>
                </div>
                <div class="qr-actions">
                    <button id="copyCodeBtn" class="action-btn secondary">å¤åˆ¶ä»£ç </button>
                    <button id="refreshQRBtn" class="action-btn primary">åˆ·æ–°äºŒç»´ç </button>
                    <button id="closeQRBtn" class="action-btn danger">å…³é—­</button>
                </div>
            </div>
            
            <!-- åŠ å…¥æˆ¿é—´é¢æ¿ -->
            <div class="join-panel" id="joinPanel" style="display: none;">
                <div class="join-header">
                    <h4>ğŸ”— åŠ å…¥æˆ¿é—´</h4>
                    <p>é€‰æ‹©åŠ å…¥æ–¹å¼</p>
                </div>
                <div class="join-options">
                    <button id="scanQRBtn" class="join-option-btn">
                        <span class="option-icon">ğŸ“·</span>
                        <span class="option-text">æ‰«æäºŒç»´ç </span>
                    </button>
                    <button id="manualInputBtn" class="join-option-btn">
                        <span class="option-icon">âŒ¨ï¸</span>
                        <span class="option-text">æ‰‹åŠ¨è¾“å…¥ä»£ç </span>
                    </button>
                </div>
                <div class="join-actions">
                    <button id="cancelJoinBtn" class="action-btn secondary">å–æ¶ˆ</button>
                </div>
            </div>
            
            <!-- æ‰‹åŠ¨è¾“å…¥é¢æ¿ -->
            <div class="manual-input-panel" id="manualInputPanel" style="display: none;">
                <div class="manual-header">
                    <h4>âŒ¨ï¸ è¾“å…¥è¿æ¥ä»£ç </h4>
                    <p>è¯·è¾“å…¥å¯¹æ–¹æä¾›çš„è¿æ¥ä»£ç </p>
                </div>
                <div class="input-container">
                    <textarea id="connectionInput" placeholder="ç²˜è´´è¿æ¥ä»£ç ..." rows="4"></textarea>
                    <div class="input-hint">è¯·ç²˜è´´å®Œæ•´çš„è¿æ¥ä»£ç </div>
                </div>
                <div class="manual-actions">
                    <button id="confirmManualBtn" class="action-btn primary">ç¡®è®¤åŠ å…¥</button>
                    <button id="backToJoinBtn" class="action-btn secondary">è¿”å›</button>
                </div>
            </div>
            
            <!-- äºŒç»´ç æ‰«æé¢æ¿ -->
            <div class="scan-panel" id="scanPanel" style="display: none;">
                <div class="scan-header">
                    <h4>ğŸ“· æ‰«æäºŒç»´ç </h4>
                    <p>å¯¹å‡†å¯¹æ–¹è®¾å¤‡çš„äºŒç»´ç </p>
                </div>
                <div class="scanner-container">
                    <video id="scannerVideo" playsinline></video>
                    <canvas id="scannerCanvas" style="display: none;"></canvas>
                    <div class="scan-frame"></div>
                </div>
                <div class="scan-actions">
                    <button id="cancelScanBtn" class="action-btn secondary">å–æ¶ˆæ‰«æ</button>
                    <button id="switchCameraBtn" class="action-btn secondary">åˆ‡æ¢æ‘„åƒå¤´</button>
                </div>
            </div>
            
            <!-- è¿æ¥æ—¥å¿— -->
            <div class="connection-log" id="connectionLog">
                <div class="log-header">
                    <span>è¿æ¥æ—¥å¿—</span>
                    <button id="clearLogBtn" class="clear-log-btn">æ¸…ç©º</button>
                </div>
                <div class="log-content" id="logContent">
                    <div class="log-entry">
                        <span class="log-time">[ç³»ç»Ÿ]</span>
                        <span class="log-info">æ¬¢è¿ä½¿ç”¨å»ä¸­å¿ƒåŒ–èŠå¤©</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chat-container" id="chatContainer" style="display: none;">
            <div class="chat-header">
                <span>ç§å¯†èŠå¤©</span>
                <span class="connection-info">å·²è¿æ¥</span>
            </div>
            <div class="messages" id="messages">
                <div class="message received">
                    <div class="message-text">è¿æ¥å·²å»ºç«‹ï¼ç°åœ¨å¯ä»¥å¼€å§‹ç§å¯†èŠå¤©äº†ã€‚</div>
                    <div class="message-time">ç³»ç»Ÿæ¶ˆæ¯</div>
                </div>
            </div>
            
            <div class="input-area">
                <input type="text" id="messageInput" placeholder="è¾“å…¥æ¶ˆæ¯..." disabled>
                <button class="send-btn" id="sendBtn" disabled>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ç®€å•çš„QRç ç”Ÿæˆåº“ -->
    <script>
        // ç®€åŒ–çš„QRç ç”Ÿæˆå™¨
        class SimpleQRCode {
            static generate(text, canvas, size = 200) {
                const ctx = canvas.getContext('2d');
                canvas.width = size;
                canvas.height = size;
                
                // æ¸…ç©ºç”»å¸ƒ
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, size, size);
                
                // ç®€å•çš„QRç æ¨¡å¼ - ä½¿ç”¨æ•°æ®URLç¼–ç 
                const encodedText = btoa(encodeURIComponent(text));
                this.drawPattern(ctx, encodedText, size);
            }
            
            static drawPattern(ctx, data, size) {
                const moduleSize = 4;
                const padding = 10;
                
                ctx.fillStyle = 'black';
                
                // ç»˜åˆ¶å®šä½å›¾æ¡ˆ
                this.drawFinderPattern(ctx, padding, padding, moduleSize);
                this.drawFinderPattern(ctx, size - padding - 7 * moduleSize, padding, moduleSize);
                this.drawFinderPattern(ctx, padding, size - padding - 7 * moduleSize, moduleSize);
                
                // ç®€å•æ•°æ®ç¼–ç 
                let x = padding + 9 * moduleSize;
                let y = padding + 9 * moduleSize;
                
                for (let i = 0; i < data.length; i++) {
                    const charCode = data.charCodeAt(i);
                    for (let bit = 0; bit < 8; bit++) {
                        if (charCode & (1 << bit)) {
                            ctx.fillRect(x, y, moduleSize, moduleSize);
                        }
                        x += moduleSize;
                        if (x >= size - padding - moduleSize) {
                            x = padding + 9 * moduleSize;
                            y += moduleSize;
                        }
                    }
                }
            }
            
            static drawFinderPattern(ctx, x, y, moduleSize) {
                ctx.fillStyle = 'black';
                ctx.fillRect(x, y, 7 * moduleSize, 7 * moduleSize);
                ctx.fillStyle = 'white';
                ctx.fillRect(x + moduleSize, y + moduleSize, 5 * moduleSize, 5 * moduleSize);
                ctx.fillStyle = 'black';
                ctx.fillRect(x + 2 * moduleSize, y + 2 * moduleSize, 3 * moduleSize, 3 * moduleSize);
            }
        }
    </script>

    <script src="app.js"></script>
</body>
</html>